import"./style-CuMWhqag.js";import{o as G,a as J,g as _,c as D,d as q,k as Q,l as V}from"./firebaseConfig-cEQ9fNQE.js";import"./footer-DqjFuR03.js";window.lastSearchResults=[];window.originalSearchResults=[];G(J,async i=>{if(!i){window.location.href="login.html";return}window.currentUser=i,console.log("Logged in as:",i.email),X()});function Y(){window.lastSearchResults=[...window.originalSearchResults]}async function O(i,o){const f=window.currentUser;if(!f)return alert("Please log in first.");const m=f.uid,y=D(q,"users",m,"craves");if((await _(y)).docs.some(x=>x.data().name===o.name))return alert(`${o.name} is already in your Craves.`);await Q(y,{name:o.name,address:o.formattedAddress||"No address available",rating:o.rating||"N/A",added_at:V()}),alert(`${o.name} added to Craves!`)}let w,S=[],A=null,c=null;function E(){S.forEach(i=>i.setMap(null)),S=[]}function M(i,o){if(c&&navigator.geolocation&&!i.distance&&i.geometry?.location){const x=i.geometry.location.lat(),h=i.geometry.location.lng();i.distance=b(c.lat,c.lng,x,h)}const f=c&&navigator.geolocation&&i.distance?j(i.distance):null,m=i.price_level&&i.price_level>0?"$".repeat(i.price_level):null,y=document.createElement("div");y.className="bg-white w-full px-3 py-2 rounded-2xl shadow",y.innerHTML=`
        <div class="flex justify-between items-start mb-2">
            <h3 class="font-bold">${i.name}</h3>
        </div>
        <p>${i.formatted_address||"No address available"}</p>
        <div class="flex items-center gap-2 mt-1">
            <p class="text-yellow-600">‚≠ê ${i.rating||"N/A"}</p>
            ${f?`<p class="text-gray-600 text-sm">üìç ${f}</p>`:""}
        </div>
        ${m?`<p class="text-gray-700">${m}</p>`:""}
    `;const d=document.createElement("button");d.textContent="+",d.className="ml-2 bg-orange-500 text-white px-3 py-1 rounded-full hover:bg-orange-400 font-bold flex-shrink-0 self-start",d.addEventListener("click",async()=>{await O(d,{name:i.name,formattedAddress:i.formatted_address,rating:i.rating}),d.textContent="‚úì Added",d.disabled=!0,d.classList.add("opacity-70")}),y.querySelector("div").appendChild(d),o.appendChild(y)}function b(i,o,f,m){const y=(f-i)*111e3,d=(m-o)*111e3*Math.cos(i*Math.PI/180);return Math.sqrt(y*y+d*d)}function j(i){return i<1e3?Math.round(i)+"m":(i/1e3).toFixed(1)+"km"}function T(i){A&&A.setMap(null);const o={path:google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#4285F4",fillOpacity:1,strokeColor:"#FFFFFF",strokeWeight:2};A=new google.maps.Marker({position:{lat:i.lat,lng:i.lng},map:w,icon:o,title:"Your Location",zIndex:1e3})}async function k(i,o){const f=new google.maps.LatLng(i.lat,i.lng);c=i,navigator.geolocation&&i.lat!==49.282868&&i.lng!==-123.125032&&T(i);const m={query:o?`${o} restaurant`:"restaurants near me",location:f,radius:1500};new google.maps.places.PlacesService(w).textSearch(m,(d,I)=>{const x=document.getElementById("resultsContainer");if(x.innerHTML="",E(),I!==google.maps.places.PlacesServiceStatus.OK||!d?.length){x.innerHTML='<p class="text-gray-600">No restaurants found.</p>',window.lastSearchResults=[];return}c&&navigator.geolocation&&(d.forEach(h=>{if(h.geometry?.location){const C=h.geometry.location.lat(),$=h.geometry.location.lng();h.distance=b(c.lat,c.lng,C,$)}else h.distance=1/0}),d.sort((h,C)=>(h.distance||1/0)-(C.distance||1/0))),window.lastSearchResults=d,window.originalSearchResults=[...d],d.forEach(h=>{if(h.geometry?.location){const C=new google.maps.Marker({map:w,position:h.geometry.location,title:h.name});S.push(C)}M(h,x)})})}async function X(){w=new google.maps.Map(document.getElementById("map"),{center:{lat:49.282868,lng:-123.125032},zoom:14}),new google.maps.places.PlacesService(w),navigator.geolocation?navigator.geolocation.getCurrentPosition(f=>{const m={lat:f.coords.latitude,lng:f.coords.longitude};w.setCenter(m),k(m)},()=>{k({lat:49.282868,lng:-123.125032})},{enableHighAccuracy:!0}):k({lat:49.282868,lng:-123.125032});const i=document.getElementById("searchButton"),o=document.getElementById("searchInput");if(i&&o){const f=()=>{const m=o.value.trim();navigator.geolocation?navigator.geolocation.getCurrentPosition(y=>{const d={lat:y.coords.latitude,lng:y.coords.longitude};w.setCenter(d),k(d,m)},()=>k({lat:49.282868,lng:-123.125032},m),{enableHighAccuracy:!0}):k({lat:49.282868,lng:-123.125032},m)};i.addEventListener("click",f),o.addEventListener("keydown",m=>{m.key==="Enter"&&(m.preventDefault(),f())})}}document.addEventListener("DOMContentLoaded",()=>{const i=document.getElementById("burger-menu"),o=document.getElementById("myDropdown"),f=i?i.closest("button"):null;let m=!1;if(i&&o){const n=a=>{a.stopPropagation(),a.preventDefault();const t=o.classList.contains("hidden");m=t,t?(o.classList.remove("hidden"),o.style.display="block",o.offsetHeight,o.classList.remove("opacity-0","scale-95"),o.classList.add("opacity-100","scale-100")):(o.classList.remove("opacity-100","scale-100"),o.classList.add("opacity-0","scale-95"),setTimeout(()=>{o.classList.add("hidden"),o.style.display=""},200))};i.addEventListener("click",n),f&&f.addEventListener("click",n),o.addEventListener("click",a=>{a.stopPropagation()}),document.addEventListener("click",a=>{m&&!o.contains(a.target)&&!i.contains(a.target)&&!(f&&f.contains(a.target))&&y()})}function y(){o.classList.contains("hidden")||(o.classList.remove("opacity-100","scale-100"),o.classList.add("opacity-0","scale-95"),setTimeout(()=>{o.classList.add("hidden"),o.style.display=""},200),m=!1)}async function d(){try{const n=await _(D(q,"filters"));o.innerHTML="",n.forEach(a=>{const t=a.data(),e=document.createElement("li");e.className="px-4 py-2 hover:bg-gray-100 cursor-pointer",e.textContent=t.filter,t.filter.toLowerCase()==="cuisine"&&e.addEventListener("click",s=>{s.stopPropagation(),I()}),t.filter.toLowerCase()==="price"&&e.addEventListener("click",s=>{s.stopPropagation(),x()}),t.filter.toLowerCase()==="reviews"&&e.addEventListener("click",s=>{s.stopPropagation(),h()}),o.appendChild(e)})}catch(n){console.error("Error loading filters:",n),o.innerHTML='<li class="px-4 py-2 text-red-500">Failed to load filters</li>'}}async function I(){o.innerHTML="",["American","BBQ","Chinese","French","Greek","Indian","Italian","Japanese","Korean","Lebanese","Mediterranean","Mexican","Middle Eastern","Spanish","Thai","Turkish","Vietnamese"].forEach(t=>{const e=document.createElement("li");e.className="px-4 py-1 flex items-center hover:bg-gray-100",e.innerHTML=`
                <input type="checkbox" value="${t}" class="mr-2 cursor-pointer checkbox-cuisine">
                <span>${t}</span>`,o.appendChild(e)});const a=document.createElement("div");a.className="flex justify-between px-4 py-2 border-t mt-2",a.innerHTML=`
            <button id="backToFilters" class="text-gray-500 hover:text-gray-700 text-sm">‚Üê Back</button>
            <button id="applyCuisine" class="bg-orange-400 text-white px-3 py-1 rounded-lg text-sm hover:bg-orange-500">Apply</button>
        `,o.appendChild(a),document.getElementById("backToFilters").addEventListener("click",t=>{t.stopPropagation(),d()}),document.getElementById("applyCuisine").addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();const e=[...document.querySelectorAll(".checkbox-cuisine:checked")].map(s=>s.value);if(e.length===0){alert("Please select at least one cuisine.");return}if(console.log("Selected cuisines:",e),window.lastSearchResults.length>0)z(e);else{const s=e.join(", ");navigator.geolocation?navigator.geolocation.getCurrentPosition(r=>k({lat:r.coords.latitude,lng:r.coords.longitude},s),()=>k({lat:49.282868,lng:-123.125032},s)):k({lat:49.282868,lng:-123.125032},s)}y()})}async function x(){o.innerHTML="",[{label:"$ ‚Üí $$$$",value:"asc"},{label:"$$$$ ‚Üí $",value:"desc"}].forEach(t=>{const e=document.createElement("li");e.className="px-4 py-2 hover:bg-gray-100 cursor-pointer",e.textContent=t.label,e.addEventListener("click",s=>{s.stopPropagation(),K(t.value)}),o.appendChild(e)});const a=document.createElement("div");a.className="flex justify-start px-4 py-2 border-t mt-2",a.innerHTML=`
            <button id="backToFilters" class="text-gray-500 hover:text-gray-700 text-sm">‚Üê Back</button>
        `,o.appendChild(a),document.getElementById("backToFilters").addEventListener("click",t=>{t.stopPropagation(),d()})}async function h(){o.innerHTML="",[{label:"‚≠ê High ‚Üí Low",value:"desc"},{label:"‚≠ê Low ‚Üí High",value:"asc"}].forEach(t=>{const e=document.createElement("li");e.className="px-4 py-2 hover:bg-gray-100 cursor-pointer",e.textContent=t.label,e.addEventListener("click",s=>{s.stopPropagation(),C(t.value)}),o.appendChild(e)});const a=document.createElement("div");a.className="flex justify-start px-4 py-2 border-t mt-2",a.innerHTML=`
            <button id="backToFilters" class="text-gray-500 hover:text-gray-700 text-sm">‚Üê Back</button>
        `,o.appendChild(a),document.getElementById("backToFilters").addEventListener("click",t=>{t.stopPropagation(),d()})}function C(n="desc"){o.classList.add("hidden");const a=document.getElementById("resultsContainer");a.innerHTML="<p class='text-gray-500 px-4'>Sorting by reviews...</p>",window.lastSearchResults.length>0?$(n):navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>P({lat:t.coords.latitude,lng:t.coords.longitude},n),()=>P({lat:49.282868,lng:-123.125032},n)):P({lat:49.282868,lng:-123.125032},n),y()}function $(n="desc"){const a=document.getElementById("resultsContainer");a.innerHTML="",E();const t=[...window.lastSearchResults];c&&navigator.geolocation&&t.forEach(e=>{if(e.geometry?.location&&!e.distance){const s=e.geometry.location.lat(),r=e.geometry.location.lng();e.distance=b(c.lat,c.lng,s,r)}}),t.sort((e,s)=>{const r=e.rating||0,u=s.rating||0,v=n==="asc"?r-u:u-r;return v===0&&c&&navigator.geolocation?(e.distance||1/0)-(s.distance||1/0):v}),F(t),N({reviews:n})}function P(n,a="desc"){const t=new google.maps.LatLng(n.lat,n.lng),e=new google.maps.places.PlacesService(w);navigator.geolocation&&n.lat!==49.282868&&n.lng!==-123.125032&&(c=n,T(n));const s={query:"restaurant",location:t,radius:5e3};e.textSearch(s,(r,u)=>{const v=document.getElementById("resultsContainer");if(v.innerHTML="",E(),u!==google.maps.places.PlacesServiceStatus.OK||!r?.length){v.innerHTML='<p class="text-gray-600">No restaurants found.</p>';return}c&&navigator.geolocation&&r.forEach(l=>{if(l.geometry?.location&&!l.distance){const g=l.geometry.location.lat(),p=l.geometry.location.lng();l.distance=b(c.lat,c.lng,g,p)}}),r.sort((l,g)=>{const p=l.rating||0,L=g.rating||0,B=a==="asc"?p-L:L-p;return B===0&&c&&navigator.geolocation?(l.distance||1/0)-(g.distance||1/0):B}),F(r)})}function F(n){const a=document.getElementById("resultsContainer");a.innerHTML="",E(),c&&navigator.geolocation&&(n.forEach(t=>{if(t.geometry?.location&&!t.distance){const e=t.geometry.location.lat(),s=t.geometry.location.lng();t.distance=b(c.lat,c.lng,e,s)}else t.geometry?.location||(t.distance=1/0)}),n.sort((t,e)=>(t.distance||1/0)-(e.distance||1/0))),n.forEach(t=>{if(t.geometry?.location){const l=new google.maps.Marker({map:w,position:t.geometry.location,title:t.name});S.push(l)}const e=t.price_level&&t.price_level>0?"$".repeat(t.price_level):null,s=c&&navigator.geolocation&&t.distance?j(t.distance):null,r=document.createElement("div");r.className="bg-white w-full px-3 py-2 rounded-2xl shadow",r.innerHTML=`
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold">${t.name}</h3>
                </div>
                <p>${t.formatted_address||"No address available"}</p>
                <div class="flex items-center gap-2 mt-1">
                    <p class="text-yellow-600">‚≠ê ${t.rating||"N/A"}</p>
                    ${s?`<p class="text-gray-600 text-sm">üìç ${s}</p>`:""}
                </div>
                ${e?`<p class="text-gray-700">${e}</p>`:""}
            `;const u=document.createElement("button");u.textContent="+",u.className="ml-2 bg-orange-500 text-white px-3 py-1 rounded-full hover:bg-orange-400 font-bold flex-shrink-0 self-start",u.addEventListener("click",async()=>{await O(u,{name:t.name,formattedAddress:t.formatted_address,rating:t.rating}),u.textContent="‚úì Added",u.disabled=!0,u.classList.add("opacity-70")}),r.querySelector("div").appendChild(u),a.appendChild(r)})}async function K(n="desc"){o.classList.add("hidden");const a=document.getElementById("resultsContainer");a.innerHTML="<p class='text-gray-500 px-4'>Sorting by price...</p>",window.lastSearchResults.length>0?U(n):navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>H({lat:t.coords.latitude,lng:t.coords.longitude},n),()=>H({lat:49.282868,lng:-123.125032},n)):H({lat:49.282868,lng:-123.125032},n),y()}async function H(n,a="desc"){const t=new google.maps.LatLng(n.lat,n.lng),e=new google.maps.places.PlacesService(w);navigator.geolocation&&n.lat!==49.282868&&n.lng!==-123.125032&&(c=n,T(n));const s={query:"restaurant",location:t,radius:1500};e.textSearch(s,(r,u)=>{const v=document.getElementById("resultsContainer");if(v.innerHTML="",E(),u!==google.maps.places.PlacesServiceStatus.OK||!r?.length){v.innerHTML='<p class="text-gray-600">No restaurants found.</p>';return}c&&navigator.geolocation&&r.forEach(l=>{if(l.geometry?.location&&!l.distance){const g=l.geometry.location.lat(),p=l.geometry.location.lng();l.distance=b(c.lat,c.lng,g,p)}}),r.sort((l,g)=>{const p=l.price_level||0,L=g.price_level||0;return a==="asc"?p-L:L-p}),c&&navigator.geolocation&&r.sort((l,g)=>{const p=l.price_level||0,L=g.price_level||0,B=a==="asc"?p-L:L-p;return B===0?(l.distance||1/0)-(g.distance||1/0):B}),r.forEach(l=>{if(l.geometry?.location){const g=new google.maps.Marker({map:w,position:l.geometry.location,title:l.name});S.push(g)}M(l,v)})})}function U(n="desc"){const a=document.getElementById("resultsContainer");a.innerHTML="",E(),Y();const t=[...window.lastSearchResults];c&&navigator.geolocation&&t.forEach(e=>{if(e.geometry?.location&&!e.distance){const s=e.geometry.location.lat(),r=e.geometry.location.lng();e.distance=b(c.lat,c.lng,s,r)}}),t.sort((e,s)=>{const r=e.price_level||0,u=s.price_level||0,v=n==="asc"?r-u:u-r;return v===0&&c&&navigator.geolocation?(e.distance||1/0)-(s.distance||1/0):v}),t.forEach(e=>{if(e.geometry?.location){const s=new google.maps.Marker({map:w,position:e.geometry.location,title:e.name});S.push(s)}M(e,a)}),N({price:n})}function z(n){const a=document.getElementById("resultsContainer");a.innerHTML="<p class='text-gray-500 px-4'>Searching for restaurants...</p>",E(),n.join(", "),navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>R({lat:t.coords.latitude,lng:t.coords.longitude},n),()=>R({lat:49.282868,lng:-123.125032},n)):R({lat:49.282868,lng:-123.125032},n)}function R(n,a){const t=new google.maps.LatLng(n.lat,n.lng),e=new google.maps.places.PlacesService(w);navigator.geolocation&&n.lat!==49.282868&&n.lng!==-123.125032&&(c=n,T(n));const r={query:`${a.join(" OR ")} restaurant`,location:t,radius:5e3};e.textSearch(r,(u,v)=>{const l=document.getElementById("resultsContainer");if(l.innerHTML="",E(),v!==google.maps.places.PlacesServiceStatus.OK||!u?.length){l.innerHTML='<p class="text-gray-600 px-4">No restaurants found for the selected cuisines.</p>';return}c&&navigator.geolocation&&(u.forEach(g=>{if(g.geometry?.location&&!g.distance){const p=g.geometry.location.lat(),L=g.geometry.location.lng();g.distance=b(c.lat,c.lng,p,L)}}),u.sort((g,p)=>(g.distance||1/0)-(p.distance||1/0))),window.lastSearchResults=u,window.originalSearchResults=[...u],u.forEach(g=>{if(g.geometry?.location){const p=new google.maps.Marker({map:w,position:g.geometry.location,title:g.name});S.push(p)}M(g,l)}),N({cuisines:a})})}function N({cuisines:n=[],price:a="",reviews:t=""}){const e=document.getElementById("filterSummary"),s=document.getElementById("filterSummaryText");let r="";n.length>0&&(r+=`üç¥ Cuisine: ${n.join(", ")}`),a&&(r&&(r+=" | "),r+=a==="asc"?"$ ‚Üí $$$$":"$$$$ ‚Üí $"),t&&(r&&(r+=" | "),r+=t==="asc"?"‚≠ê Low ‚Üí High":"‚≠ê High ‚Üí Low"),s.textContent=r||"",e.classList.remove("hidden"),document.getElementById("clearFiltersBtn").onclick=()=>{W()},window.scrollTo({top:0,behavior:"smooth"})}function W(){if(document.getElementById("filterSummary").classList.add("hidden"),window.originalSearchResults.length===0)return;window.lastSearchResults=[...window.originalSearchResults],c&&navigator.geolocation&&(window.lastSearchResults.forEach(t=>{if(t.geometry?.location){const e=t.geometry.location.lat(),s=t.geometry.location.lng();t.distance=b(c.lat,c.lng,e,s)}}),window.lastSearchResults.sort((t,e)=>(t.distance||1/0)-(e.distance||1/0)));const a=document.getElementById("resultsContainer");a.innerHTML="",E(),window.lastSearchResults.forEach(t=>{if(t.geometry?.location){const e=new google.maps.Marker({map:w,position:t.geometry.location,title:t.name});S.push(e)}M(t,a)}),window.scrollTo({top:0,behavior:"smooth"})}d()});
