import"./style-CbcU32hS.js";import{o as G,a as J,g as F,c as _,d as O,k as Q,l as V}from"./firebaseConfig-cEQ9fNQE.js";import"./footer-DqjFuR03.js";window.lastSearchResults=[];window.originalSearchResults=[];G(J,async o=>{if(!o){window.location.href="login.html";return}window.currentUser=o,console.log("Logged in as:",o.email),Y()});function W(){window.lastSearchResults=[...window.originalSearchResults]}async function q(o,a){const f=window.currentUser;if(!f)return alert("Please log in first.");const m=f.uid,y=_(O,"users",m,"craves");if((await F(y)).docs.some(x=>x.data().name===a.name))return alert(`${a.name} is already in your Craves.`);await Q(y,{name:a.name,address:a.formattedAddress||"No address available",rating:a.rating||"N/A",added_at:V()}),alert(`${a.name} added to Craves!`)}let w,k=[],N=null,c=null;function E(){k.forEach(o=>o.setMap(null)),k=[]}function T(o,a){if(c&&navigator.geolocation&&!o.distance&&o.geometry?.location){const x=o.geometry.location.lat(),h=o.geometry.location.lng();o.distance=b(c.lat,c.lng,x,h)}const f=c&&navigator.geolocation&&o.distance?D(o.distance):null,m=o.price_level&&o.price_level>0?"$".repeat(o.price_level):null,y=document.createElement("div");y.className="bg-white w-full px-3 py-2 rounded-2xl shadow",y.innerHTML=`
        <div class="flex justify-between items-start mb-2">
            <h3 class="font-bold">${o.name}</h3>
        </div>
        <p>${o.formatted_address||"No address available"}</p>
        <div class="flex items-center gap-2 mt-1">
            <p class="text-yellow-600">‚≠ê ${o.rating||"N/A"}</p>
            ${f?`<p class="text-gray-600 text-sm">üìç ${f}</p>`:""}
        </div>
        ${m?`<p class="text-gray-700">${m}</p>`:""}
    `;const u=document.createElement("button");u.textContent="+",u.className="ml-2 bg-orange-500 text-white px-3 py-1 rounded-full hover:bg-orange-400 font-bold flex-shrink-0 self-start",u.addEventListener("click",async()=>{await q(u,{name:o.name,formattedAddress:o.formatted_address,rating:o.rating}),u.textContent="‚úì Added",u.disabled=!0,u.classList.add("opacity-70")}),y.querySelector("div").appendChild(u),a.appendChild(y)}function b(o,a,f,m){const y=(f-o)*111e3,u=(m-a)*111e3*Math.cos(o*Math.PI/180);return Math.sqrt(y*y+u*u)}function D(o){return o<1e3?Math.round(o)+"m":(o/1e3).toFixed(1)+"km"}function $(o){N&&N.setMap(null);const a={path:google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#4285F4",fillOpacity:1,strokeColor:"#FFFFFF",strokeWeight:2};N=new google.maps.Marker({position:{lat:o.lat,lng:o.lng},map:w,icon:a,title:"Your Location",zIndex:1e3})}async function S(o,a){const f=new google.maps.LatLng(o.lat,o.lng);c=o,navigator.geolocation&&o.lat!==49.282868&&o.lng!==-123.125032&&$(o);const m={query:a?`${a} restaurant`:"restaurants near me",location:f,radius:1500};new google.maps.places.PlacesService(w).textSearch(m,(u,I)=>{const x=document.getElementById("resultsContainer");if(x.innerHTML="",E(),I!==google.maps.places.PlacesServiceStatus.OK||!u?.length){x.innerHTML='<p class="text-gray-600">No restaurants found.</p>',window.lastSearchResults=[];return}c&&navigator.geolocation&&(u.forEach(h=>{if(h.geometry?.location){const C=h.geometry.location.lat(),B=h.geometry.location.lng();h.distance=b(c.lat,c.lng,C,B)}else h.distance=1/0}),u.sort((h,C)=>(h.distance||1/0)-(C.distance||1/0))),window.lastSearchResults=u,window.originalSearchResults=[...u],u.forEach(h=>{if(h.geometry?.location){const C=new google.maps.Marker({map:w,position:h.geometry.location,title:h.name});k.push(C)}T(h,x)})})}async function Y(){w=new google.maps.Map(document.getElementById("map"),{center:{lat:49.282868,lng:-123.125032},zoom:14}),new google.maps.places.PlacesService(w),navigator.geolocation?navigator.geolocation.getCurrentPosition(f=>{const m={lat:f.coords.latitude,lng:f.coords.longitude};w.setCenter(m),S(m)},()=>{S({lat:49.282868,lng:-123.125032})},{enableHighAccuracy:!0}):S({lat:49.282868,lng:-123.125032});const o=document.getElementById("searchButton"),a=document.getElementById("searchInput");if(o&&a){const f=()=>{const m=a.value.trim();navigator.geolocation?navigator.geolocation.getCurrentPosition(y=>{const u={lat:y.coords.latitude,lng:y.coords.longitude};w.setCenter(u),S(u,m)},()=>S({lat:49.282868,lng:-123.125032},m),{enableHighAccuracy:!0}):S({lat:49.282868,lng:-123.125032},m)};o.addEventListener("click",f),a.addEventListener("keydown",m=>{m.key==="Enter"&&(m.preventDefault(),f())})}}document.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("burger-menu"),a=document.getElementById("myDropdown");let f=!1;o&&a&&(o.addEventListener("click",n=>{n.stopPropagation();const i=a.classList.contains("hidden");a.classList.toggle("hidden"),f=i,i?(a.classList.remove("opacity-0","scale-95"),setTimeout(()=>{a.classList.add("opacity-100","scale-100")},10)):(a.classList.remove("opacity-100","scale-100"),a.classList.add("opacity-0","scale-95"))}),a.addEventListener("click",n=>{n.stopPropagation()}),document.addEventListener("click",n=>{f&&!a.contains(n.target)&&!o.contains(n.target)&&m()}));function m(){a.classList.add("hidden"),a.classList.remove("opacity-100","scale-100"),a.classList.add("opacity-0","scale-95"),f=!1}async function y(){try{const n=await F(_(O,"filters"));a.innerHTML="",n.forEach(i=>{const t=i.data(),e=document.createElement("li");e.className="px-4 py-2 hover:bg-gray-100 cursor-pointer",e.textContent=t.filter,t.filter.toLowerCase()==="cuisine"&&e.addEventListener("click",s=>{s.stopPropagation(),u()}),t.filter.toLowerCase()==="price"&&e.addEventListener("click",s=>{s.stopPropagation(),I()}),t.filter.toLowerCase()==="reviews"&&e.addEventListener("click",s=>{s.stopPropagation(),x()}),a.appendChild(e)})}catch(n){console.error("Error loading filters:",n),a.innerHTML='<li class="px-4 py-2 text-red-500">Failed to load filters</li>'}}async function u(){a.innerHTML="",["American","BBQ","Chinese","French","Greek","Indian","Italian","Japanese","Korean","Lebanese","Mediterranean","Mexican","Middle Eastern","Spanish","Thai","Turkish","Vietnamese"].forEach(t=>{const e=document.createElement("li");e.className="px-4 py-1 flex items-center hover:bg-gray-100",e.innerHTML=`
                <input type="checkbox" value="${t}" class="mr-2 cursor-pointer checkbox-cuisine">
                <span>${t}</span>`,a.appendChild(e)});const i=document.createElement("div");i.className="flex justify-between px-4 py-2 border-t mt-2",i.innerHTML=`
            <button id="backToFilters" class="text-gray-500 hover:text-gray-700 text-sm">‚Üê Back</button>
            <button id="applyCuisine" class="bg-orange-400 text-white px-3 py-1 rounded-lg text-sm hover:bg-orange-500">Apply</button>
        `,a.appendChild(i),document.getElementById("backToFilters").addEventListener("click",t=>{t.stopPropagation(),y()}),document.getElementById("applyCuisine").addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();const e=[...document.querySelectorAll(".checkbox-cuisine:checked")].map(s=>s.value);if(e.length===0){alert("Please select at least one cuisine.");return}if(console.log("Selected cuisines:",e),window.lastSearchResults.length>0)U(e);else{const s=e.join(", ");navigator.geolocation?navigator.geolocation.getCurrentPosition(r=>S({lat:r.coords.latitude,lng:r.coords.longitude},s),()=>S({lat:49.282868,lng:-123.125032},s)):S({lat:49.282868,lng:-123.125032},s)}m()})}async function I(){a.innerHTML="",[{label:"$ ‚Üí $$$$",value:"asc"},{label:"$$$$ ‚Üí $",value:"desc"}].forEach(t=>{const e=document.createElement("li");e.className="px-4 py-2 hover:bg-gray-100 cursor-pointer",e.textContent=t.label,e.addEventListener("click",s=>{s.stopPropagation(),j(t.value)}),a.appendChild(e)});const i=document.createElement("div");i.className="flex justify-start px-4 py-2 border-t mt-2",i.innerHTML=`
            <button id="backToFilters" class="text-gray-500 hover:text-gray-700 text-sm">‚Üê Back</button>
        `,a.appendChild(i),document.getElementById("backToFilters").addEventListener("click",t=>{t.stopPropagation(),y()})}async function x(){a.innerHTML="",[{label:"‚≠ê High ‚Üí Low",value:"desc"},{label:"‚≠ê Low ‚Üí High",value:"asc"}].forEach(t=>{const e=document.createElement("li");e.className="px-4 py-2 hover:bg-gray-100 cursor-pointer",e.textContent=t.label,e.addEventListener("click",s=>{s.stopPropagation(),h(t.value)}),a.appendChild(e)});const i=document.createElement("div");i.className="flex justify-start px-4 py-2 border-t mt-2",i.innerHTML=`
            <button id="backToFilters" class="text-gray-500 hover:text-gray-700 text-sm">‚Üê Back</button>
        `,a.appendChild(i),document.getElementById("backToFilters").addEventListener("click",t=>{t.stopPropagation(),y()})}function h(n="desc"){a.classList.add("hidden");const i=document.getElementById("resultsContainer");i.innerHTML="<p class='text-gray-500 px-4'>Sorting by reviews...</p>",window.lastSearchResults.length>0?C(n):navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>B({lat:t.coords.latitude,lng:t.coords.longitude},n),()=>B({lat:49.282868,lng:-123.125032},n)):B({lat:49.282868,lng:-123.125032},n),m()}function C(n="desc"){const i=document.getElementById("resultsContainer");i.innerHTML="",E();const t=[...window.lastSearchResults];c&&navigator.geolocation&&t.forEach(e=>{if(e.geometry?.location&&!e.distance){const s=e.geometry.location.lat(),r=e.geometry.location.lng();e.distance=b(c.lat,c.lng,s,r)}}),t.sort((e,s)=>{const r=e.rating||0,g=s.rating||0,v=n==="asc"?r-g:g-r;return v===0&&c&&navigator.geolocation?(e.distance||1/0)-(s.distance||1/0):v}),A(t),H({reviews:n})}function B(n,i="desc"){const t=new google.maps.LatLng(n.lat,n.lng),e=new google.maps.places.PlacesService(w);navigator.geolocation&&n.lat!==49.282868&&n.lng!==-123.125032&&(c=n,$(n));const s={query:"restaurant",location:t,radius:5e3};e.textSearch(s,(r,g)=>{const v=document.getElementById("resultsContainer");if(v.innerHTML="",E(),g!==google.maps.places.PlacesServiceStatus.OK||!r?.length){v.innerHTML='<p class="text-gray-600">No restaurants found.</p>';return}c&&navigator.geolocation&&r.forEach(l=>{if(l.geometry?.location&&!l.distance){const d=l.geometry.location.lat(),p=l.geometry.location.lng();l.distance=b(c.lat,c.lng,d,p)}}),r.sort((l,d)=>{const p=l.rating||0,L=d.rating||0,M=i==="asc"?p-L:L-p;return M===0&&c&&navigator.geolocation?(l.distance||1/0)-(d.distance||1/0):M}),A(r)})}function A(n){const i=document.getElementById("resultsContainer");i.innerHTML="",E(),c&&navigator.geolocation&&(n.forEach(t=>{if(t.geometry?.location&&!t.distance){const e=t.geometry.location.lat(),s=t.geometry.location.lng();t.distance=b(c.lat,c.lng,e,s)}else t.geometry?.location||(t.distance=1/0)}),n.sort((t,e)=>(t.distance||1/0)-(e.distance||1/0))),n.forEach(t=>{if(t.geometry?.location){const l=new google.maps.Marker({map:w,position:t.geometry.location,title:t.name});k.push(l)}const e=t.price_level&&t.price_level>0?"$".repeat(t.price_level):null,s=c&&navigator.geolocation&&t.distance?D(t.distance):null,r=document.createElement("div");r.className="bg-white w-full px-3 py-2 rounded-2xl shadow",r.innerHTML=`
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold">${t.name}</h3>
                </div>
                <p>${t.formatted_address||"No address available"}</p>
                <div class="flex items-center gap-2 mt-1">
                    <p class="text-yellow-600">‚≠ê ${t.rating||"N/A"}</p>
                    ${s?`<p class="text-gray-600 text-sm">üìç ${s}</p>`:""}
                </div>
                ${e?`<p class="text-gray-700">${e}</p>`:""}
            `;const g=document.createElement("button");g.textContent="+",g.className="ml-2 bg-orange-500 text-white px-3 py-1 rounded-full hover:bg-orange-400 font-bold flex-shrink-0 self-start",g.addEventListener("click",async()=>{await q(g,{name:t.name,formattedAddress:t.formatted_address,rating:t.rating}),g.textContent="‚úì Added",g.disabled=!0,g.classList.add("opacity-70")}),r.querySelector("div").appendChild(g),i.appendChild(r)})}async function j(n="desc"){a.classList.add("hidden");const i=document.getElementById("resultsContainer");i.innerHTML="<p class='text-gray-500 px-4'>Sorting by price...</p>",window.lastSearchResults.length>0?K(n):navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>P({lat:t.coords.latitude,lng:t.coords.longitude},n),()=>P({lat:49.282868,lng:-123.125032},n)):P({lat:49.282868,lng:-123.125032},n),m()}async function P(n,i="desc"){const t=new google.maps.LatLng(n.lat,n.lng),e=new google.maps.places.PlacesService(w);navigator.geolocation&&n.lat!==49.282868&&n.lng!==-123.125032&&(c=n,$(n));const s={query:"restaurant",location:t,radius:1500};e.textSearch(s,(r,g)=>{const v=document.getElementById("resultsContainer");if(v.innerHTML="",E(),g!==google.maps.places.PlacesServiceStatus.OK||!r?.length){v.innerHTML='<p class="text-gray-600">No restaurants found.</p>';return}c&&navigator.geolocation&&r.forEach(l=>{if(l.geometry?.location&&!l.distance){const d=l.geometry.location.lat(),p=l.geometry.location.lng();l.distance=b(c.lat,c.lng,d,p)}}),r.sort((l,d)=>{const p=l.price_level||0,L=d.price_level||0;return i==="asc"?p-L:L-p}),c&&navigator.geolocation&&r.sort((l,d)=>{const p=l.price_level||0,L=d.price_level||0,M=i==="asc"?p-L:L-p;return M===0?(l.distance||1/0)-(d.distance||1/0):M}),r.forEach(l=>{if(l.geometry?.location){const d=new google.maps.Marker({map:w,position:l.geometry.location,title:l.name});k.push(d)}T(l,v)})})}function K(n="desc"){const i=document.getElementById("resultsContainer");i.innerHTML="",E(),W();const t=[...window.lastSearchResults];c&&navigator.geolocation&&t.forEach(e=>{if(e.geometry?.location&&!e.distance){const s=e.geometry.location.lat(),r=e.geometry.location.lng();e.distance=b(c.lat,c.lng,s,r)}}),t.sort((e,s)=>{const r=e.price_level||0,g=s.price_level||0,v=n==="asc"?r-g:g-r;return v===0&&c&&navigator.geolocation?(e.distance||1/0)-(s.distance||1/0):v}),t.forEach(e=>{if(e.geometry?.location){const s=new google.maps.Marker({map:w,position:e.geometry.location,title:e.name});k.push(s)}T(e,i)}),H({price:n})}function U(n){const i=document.getElementById("resultsContainer");i.innerHTML="<p class='text-gray-500 px-4'>Searching for restaurants...</p>",E(),n.join(", "),navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>R({lat:t.coords.latitude,lng:t.coords.longitude},n),()=>R({lat:49.282868,lng:-123.125032},n)):R({lat:49.282868,lng:-123.125032},n)}function R(n,i){const t=new google.maps.LatLng(n.lat,n.lng),e=new google.maps.places.PlacesService(w);navigator.geolocation&&n.lat!==49.282868&&n.lng!==-123.125032&&(c=n,$(n));const r={query:`${i.join(" OR ")} restaurant`,location:t,radius:5e3};e.textSearch(r,(g,v)=>{const l=document.getElementById("resultsContainer");if(l.innerHTML="",E(),v!==google.maps.places.PlacesServiceStatus.OK||!g?.length){l.innerHTML='<p class="text-gray-600 px-4">No restaurants found for the selected cuisines.</p>';return}c&&navigator.geolocation&&(g.forEach(d=>{if(d.geometry?.location&&!d.distance){const p=d.geometry.location.lat(),L=d.geometry.location.lng();d.distance=b(c.lat,c.lng,p,L)}}),g.sort((d,p)=>(d.distance||1/0)-(p.distance||1/0))),window.lastSearchResults=g,window.originalSearchResults=[...g],g.forEach(d=>{if(d.geometry?.location){const p=new google.maps.Marker({map:w,position:d.geometry.location,title:d.name});k.push(p)}T(d,l)}),H({cuisines:i})})}function H({cuisines:n=[],price:i="",reviews:t=""}){const e=document.getElementById("filterSummary"),s=document.getElementById("filterSummaryText");let r="";n.length>0&&(r+=`üç¥ Cuisine: ${n.join(", ")}`),i&&(r&&(r+=" | "),r+=i==="asc"?"$ ‚Üí $$$$":"$$$$ ‚Üí $"),t&&(r&&(r+=" | "),r+=t==="asc"?"‚≠ê Low ‚Üí High":"‚≠ê High ‚Üí Low"),s.textContent=r||"",e.classList.remove("hidden"),document.getElementById("clearFiltersBtn").onclick=()=>{z()},window.scrollTo({top:0,behavior:"smooth"})}function z(){if(document.getElementById("filterSummary").classList.add("hidden"),window.originalSearchResults.length===0)return;window.lastSearchResults=[...window.originalSearchResults],c&&navigator.geolocation&&(window.lastSearchResults.forEach(t=>{if(t.geometry?.location){const e=t.geometry.location.lat(),s=t.geometry.location.lng();t.distance=b(c.lat,c.lng,e,s)}}),window.lastSearchResults.sort((t,e)=>(t.distance||1/0)-(e.distance||1/0)));const i=document.getElementById("resultsContainer");i.innerHTML="",E(),window.lastSearchResults.forEach(t=>{if(t.geometry?.location){const e=new google.maps.Marker({map:w,position:t.geometry.location,title:t.name});k.push(e)}T(t,i)}),window.scrollTo({top:0,behavior:"smooth"})}y()});
