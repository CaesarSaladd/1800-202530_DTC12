import{a as C,c as h,d as l,g as p,w as E,b as f,e as S}from"./firebaseConfig-cEQ9fNQE.js";async function B(){C.onAuthStateChanged(async e=>{const o=document.getElementById("craves"),d=document.getElementById("profCraves");let a;e?a=e.uid:a="guestUser";try{const n=h(l,"users",a,"craves");(await p(n)).forEach(c=>{const r=c.data();let i=r.name,m=r.rating||"N/A",y=r.address||"N/A",w=r.place_id||r.id;const t=o.content.cloneNode(!0),u=t.querySelector("div.w-80");t.querySelector(".craveName").textContent=i,t.querySelector(".craveReview").textContent=m+"★",t.querySelector(".craveAddress").textContent=y;const s=t.querySelector(".viewMenuLink");if(s&&w)s.href=`https://www.google.com/maps/place/?q=place_id:${w}`,s.target="_blank",s.rel="noopener noreferrer";else if(s){const g=encodeURIComponent(`${i} ${y}`);s.href=`https://www.google.com/maps/search/?api=1&query=${g}`,s.target="_blank",s.rel="noopener noreferrer"}t.querySelector(".delButton").addEventListener("click",async()=>{try{await S(f(l,"users",a,"craves",c.id)),u.remove()}catch(g){console.log(g)}}),t.querySelector(".writeReviewBtn").addEventListener("click",()=>{localStorage.setItem("restaurantDocID",c.id),window.location.href="review.html"}),d.appendChild(u)})}catch(n){console.error("Error loading craves:",n)}})}async function A(){C.onAuthStateChanged(async e=>{if(!e)return;const o=document.getElementById("reviews"),d=document.getElementById("profReviews"),a=e.uid;try{const n=h(l,"users",a,"reviews");(await p(n)).forEach(c=>{const r=c.data(),i=r.restaurantName,m=r.rating||"N/A",y=r.restaurantAddress||"N/A",w=r.description||"",t=o.content.cloneNode(!0),u=t.querySelector("div.w-80");t.querySelector(".reviewName").textContent=i,t.querySelector(".reviewRating").textContent=m+"★",t.querySelector(".reviewAddress").textContent=y,t.querySelector(".reviewDescription").textContent=w,t.querySelector(".delButton").addEventListener("click",async()=>{try{await S(f(l,"users",a,"reviews",c.id)),u.remove()}catch(q){console.log(q)}}),d.appendChild(u)})}catch(n){console.error("Error loading reviews:",n)}})}document.addEventListener("click",e=>{const o=e.target.closest(".dropdownBtn");o&&o.nextElementSibling.classList.toggle("hidden")});async function I(){return new Promise(e=>{C.onAuthStateChanged(async o=>{if(!o){console.log("No user logged in"),e();return}const d=o.uid,a=document.getElementById("profCraves");try{const n=h(l,"users",d,"craves"),v=await p(n);if(v.empty){console.log("No craves to clear"),e();return}const c=E(l);v.forEach(r=>{const i=f(l,"users",d,"craves",r.id);c.delete(i)}),await c.commit(),a.innerHTML="",console.log("All craves cleared successfully"),e()}catch(n){console.error("Error clearing craves:",n),e()}})})}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("clearCravesBtn");e&&e.addEventListener("click",async()=>{confirm("Are you sure you want to clear all your craves? This action cannot be undone.")&&(e.disabled=!0,e.textContent="Clearing...",await I(),e.disabled=!1,e.textContent="Clear Craves")})});B();A();
